## Swagger for REST APIs

### Continuous deployment

The specs are continuously deployed and available in Swagger UI:

- [couchbase-lite](http://docs.couchbasemobile.com/couchbase-lite)
- [sync-gateway-admin](http://docs.couchbasemobile.com/sync-gateway-admin)
- [sync-gateway-public](http://docs.couchbasemobile.com/sync-gateway-public)

A Jenkins job called SwaggerContinuousDelivery on http://docs.couchbasemobile.com:8080 is notified when a new commit is detected on the master branch. The job resolves the yaml files into one and outputs the json specs using the `resolve.js` script. This Jenkins server is for internal use.

### Working locally on swagger specs

The Swagger specs are located in the `swagger` folder in YAML format.

1. Install gulp: `npm install -g gulp`
2. Install local dependencies: `npm install`
3. Start the resolver and validator script: `gulp watch`

There are two gulp tasks available:

- build: only builds and outputs to `./tmp`
- watch: build and keep monitoring for changes in `.yaml` files

In addition, you can test the library generated by [swagger-js](https://github.com/swagger-api/swagger-js) against a running instance of Sync Gateway.

An example can be found in `swagger-js.js`.

1. Install nodemon to have the program restart when it changes: `npm install -g nodemon`
2. Start it: `nodemon swagger-js.js`
3. Make changes in `swagger-js.js` and the program should automatically restart

This template loads `tmp/admin.json`. You can edit it to load `tmp/lite.json` or `tmp/public.json`.

### Custom HTML output

Not currently supported, but there is an option to use the open source bootprint-openapi repo (submodule in `swagger`) to generate HTML that can be pushed to IngestStage.
