<?xml version="1.0" encoding="UTF-8"?>
<article xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="../../../../../docs.xsd" 
	id="post-server-replicate">
	<title>POST _replicate</title>
	<description>Retrieve a list of all databases</description>
	<introduction />

	<topics>
		<topic id="request">
			<title>Request</title>
			<body>
				<paragraph><strong>Request headers</strong></paragraph>
				<paragraph>The request uses the following header:</paragraph>
                <unordered-list>
                    <list-item>
                        <code>Content-Type</code> (<emphasis>Required</emphasis>): Must be <code>application/json</code>.
                    </list-item>
                </unordered-list>
				<paragraph><strong>Query parameters</strong></paragraph>
				<paragraph>This request does not use query parameters.</paragraph>
				<paragraph><strong>Message body</strong></paragraph>
				<paragraph>The message body is a JSON document that contains the following
					objects:</paragraph>
				<table>
					<header>
						<row>
							<entry>Name</entry>
							<entry>Type</entry>
							<entry>Description</entry>
							<entry>Default</entry>
						</row>
					</header>
					<body>
						<row>
							<entry><code>source</code></entry>
							<entry>URL</entry>
							<entry><emphasis>Required</emphasis>. A URL pointing to the source database for the replication, the URL may be relative i.e. just the name of a local database on the Sync Gateway instance. The URL may point to the Admin REST API which will replicate all documents in the DB, or it may point to the public REST API which will only copy documents in the the users assigned channels.</entry>
							<entry>none</entry>
						</row>
						<row>
							<entry><code>target</code></entry>
							<entry>URL</entry>
							<entry><emphasis>Required</emphasis>. A URL pointing to the target database for the replication, the URL may be relative i.e. just the name of a local database on the Sync Gateway instance. The URL may point to the Admin REST API or it may point to the public REST API, this will impact the behaviour of the target database sync function.</entry>
							<entry>none</entry>
						</row>
						<row>
							<entry><code>continuous</code></entry>
							<entry>Boolean</entry>
							<entry><emphasis>Optional</emphasis>. Indicates whether the replication should be a one-shot or continuous replication.</entry>
							<entry>false</entry>
						</row>
						<row>
							<entry><code>filter</code></entry>
							<entry>String</entry>
							<entry><emphasis>Optional</emphasis>. Passes the name of filter to apply to the source docuemnts, currently the only supported filter is  <emphasis>&quot;sync_gateway/bychannel&quot;</emphasis>, this will replicate documents only from the set of named channels.</entry>
							<entry>None</entry>
						</row>
						<row>
							<entry><code>query_params</code></entry>
							<entry>Object</entry>
							<entry><emphasis>Optional</emphasis>. Passes parameters to the filter, for the <emphasis>&quot;sync_gateway/bychannel&quot;</emphasis> filter the value should be an array or channel names (JSON strings).</entry>
							<entry>none</entry>
						</row>
						<row>
							<entry><code>cancel</code></entry>
							<entry>Boolean</entry>
							<entry><emphasis>Optional</emphasis>. Indicates that a running replication task should be cancelled, the running task is identified by passing its <emphasis>replication_id</emphasis> or by passing the original <emphasis>source</emphasis>, <emphasis>target</emphasis> and <emphasis>continuous</emphasis> values.</entry>
							<entry>false</entry>
						</row>
						<row>
							<entry><code>replication_id</code></entry>
							<entry>String</entry>
							<entry><emphasis>Optional</emphasis>. If the <emphasis>cancel</emphasis> parameter is true then this is the id of the active replication task to be cancelled, otherwise this is the replication_id to be used for the new replication. If no replication_id is given for a new replication it will be assigned a random UUID.</entry>
							<entry>false</entry>
						</row>
						<row>
							<entry><code>async</code></entry>
							<entry>Boolean</entry>
							<entry><emphasis>Optional</emphasis>. Indicates that a one-shot replication should be run asynchronously and the request should return immediately. Replication progress can be monitored by using the _active_tasks resource.</entry>
							<entry>false</entry>
						</row>
						<row>
							<entry><code>changes_feed_limit</code></entry>
							<entry>Number</entry>
							<entry><emphasis>Optional</emphasis>. The maximum number of change entries to pull in each loop of a continuous changes feed.</entry>
							<entry>50</entry>
						</row>
					</body>
				</table>
			</body>
		</topic>
		<topic id="response">
			<title>Response</title>
			<body>
				<paragraph><strong>Status codes</strong></paragraph>
				<paragraph><strong>Response headers</strong></paragraph>
				<paragraph>This response uses only standard HTTP headers.</paragraph>
				<paragraph><strong>Message body</strong></paragraph>
				<paragraph>The response message contains the following object:</paragraph>
				<table>

					<header>
						<row>
							<entry>Name</entry>
							<entry>Type</entry>
							<entry>Description</entry>
						</row>
					</header>

					<body>
						<row>
							<entry>not applicable</entry>
							<entry>Object</entry>
							<entry>The stats of the replication task at the time when the request returns, for a synchronous <strong>one-shot</strong> replication this will be the stats for the complete replication, for a <strong>cancel</strong> request this will be the stats at the point the replication was stopped, for all other replications this will be snapshot stats</entry>
						</row>
					</body>
				</table>
			</body>
		</topic>

		<topic id="example">
			<title>Examples</title>
			<body>
				<paragraph>The following example requests a new one-shot synchronous replication between two local databases. The
					response returnes the stats of the completed replication.</paragraph>
				<paragraph><strong>Request</strong></paragraph>
				<code-block>
POST /_replicate HTTP/1.1
Host: localhost:4984
Content-Type: application/json
{
    "source":"source",
    "target":"target"
}
</code-block>
				<paragraph><strong>Response</strong></paragraph>
				<code-block>
HTTP/1.1 200 OK
Content-Length: 264
Server: Couchbase Sync Gateway/1.3.0
Content-Type: application/json
Cache-Control: must-revalidate
Date: Mon, 09 Dec 2013 01:45:38 GMT
{
    "type":"replication",
    "replication_id":"3791d562153505408e0b2730603ed7c1",
    "continuous":false,
    "source":"http://0.0.0.0:4985/source",
    "target":"http://0.0.0.0:4985/target",
    "docs_read":12,
    "docs_written":12,
    "doc_write_failures":0,
    "start_last_seq":0,
    "end_last_seq":"28"
}
				</code-block>
				<paragraph>The following example requests a new continuous replication between two local databases with a user defined replication_id. The
					response returnes the stats of the replication immediately after it started.</paragraph>
				<paragraph><strong>Request</strong></paragraph>
				<code-block>
POST /_replicate HTTP/1.1
Host: localhost:4984
Content-Type: application/json
{
    "source":"source",
    "target":"target",
    "continuous":true,
    "replication_id":"my-named-replication"
}
</code-block>
				<paragraph><strong>Response</strong></paragraph>
				<code-block>
HTTP/1.1 200 OK
Content-Length: 261
Server: Couchbase Sync Gateway/1.3.0
Content-Type: application/json
Cache-Control: must-revalidate
Date: Mon, 09 Dec 2013 01:45:38 GMT
{
    "type":"replication",
    "replication_id":"my-named-replication",
    "continuous":true,"source":"http://0.0.0.0:4985/source",
    "target":"http://0.0.0.0:4985/target",
    "docs_read":0,
    "docs_written":0,
    "doc_write_failures":0,
    "start_last_seq":0,
    "end_last_seq":null
}
				</code-block>
				<paragraph>The following example requests the cancellation of an active replication by its replication_id. The
					response returnes the stats of the replication immediately after it was stopped.</paragraph>
				<paragraph><strong>Request</strong></paragraph>
				<code-block>
POST /_replicate HTTP/1.1
Host: localhost:4984
Content-Type: application/json
{
    "cancel":true,
    "replication_id":"my-named-replication"
}
</code-block>
				<paragraph><strong>Response</strong></paragraph>
				<code-block>
HTTP/1.1 200 OK
Content-Length: 251
Server: Couchbase Sync Gateway/1.3.0
Content-Type: application/json
Cache-Control: must-revalidate
Date: Mon, 09 Dec 2013 01:45:38 GMT
{
    "type":"replication",
    "replication_id":"my-named-replication",
    "continuous":true,
    "source":"http://0.0.0.0:4985/source",
    "target":"http://0.0.0.0:4985/target",
    "docs_read":12,
    "docs_written":12,
    "doc_write_failures":0,
    "start_last_seq":0,
    "end_last_seq":null
}
				</code-block>
				<paragraph>The following example requests the cancellation of an active replication by its original source, target and continuous parameters. The
					response returnes the stats of the replication immediately after it was stopped.</paragraph>
				<paragraph><strong>Request</strong></paragraph>
				<code-block>
POST /_replicate HTTP/1.1
Host: localhost:4984
Content-Type: application/json
{
    "cancel":true,
    "source":"source",
    "target":"target",
    "continuous":true
}
</code-block>
				<paragraph><strong>Response</strong></paragraph>
				<code-block>
HTTP/1.1 200 OK
Content-Length: 251
Server: Couchbase Sync Gateway/1.3.0
Content-Type: application/json
Cache-Control: must-revalidate
Date: Mon, 09 Dec 2013 01:45:38 GMT
{
    "type":"replication",
    "replication_id":"5eab76cda2174f7aee393b9c50ce25e4",
    "continuous":true,
    "source":"http://0.0.0.0:4985/source",
    "target":"http://0.0.0.0:4985/target",
    "docs_read":0,
    "docs_written":0,
    "doc_write_failures":0,
    "start_last_seq":0,
	"end_last_seq":null
					}
</code-block>
			</body>
		</topic>

	</topics>

</article>
