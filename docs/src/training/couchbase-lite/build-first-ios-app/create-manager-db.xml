<?xml version="1.0" encoding="UTF-8"?>
<lesson xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="../../../docs.xsd" id="create-manager-db">
	<title>Creating the manager and a database</title>
	<description>Create a manager and a database for HelloCBL</description>
	<introduction>
		<paragraph>Every Couchbase Lite application needs a manager object, which manages access to databases. This section shows you how to create the manager and a
			database.</paragraph>
		<paragraph>In this section, you replace stub code in the <code>HCAppDelegate.m</code>
			file with functional code.</paragraph>
	</introduction>
	<tasks>

		<task id="create-manager">
			<title>Create a manager</title>
			<body>
				<ordered-list>
					<list-item>
						<paragraph>Replace the stub for the <code>createTheManager</code> method in the
							<code>HCAppDelegate.m</code> file with the following functional
							code:</paragraph>
						<code-block language="objective-c">
// creates the manager object
- (BOOL) createTheManager {
    
    // create a shared instance of CBLManager
    _manager = [CBLManager sharedInstance];
    if (!_manager) {
        NSLog (@"Cannot create shared instance of CBLManager");
        return NO;
    }
    
    NSLog (@"Manager created");
    
    return YES;
    
}							
						</code-block>
						<paragraph>The <code>createTheManager</code> method creates the manager and then
							logs a success message. It is called from the
							<code>application:didFinishLaunchingWithOptions:</code> method, which is a good
							place to put it in a production app. However, when writing a production app,
							you will want to make the manager accessible to other classes.</paragraph>
					</list-item>
					<list-item>
						<paragraph>Build and run the app.</paragraph>
					</list-item>
					<list-item>View the console output. <paragraph>The console output displays a message
						similar to the following one that says the run was successful.</paragraph>
						<code-block>
2014-05-07 14:25:35.324 HelloCBL[29967:60b] Manager created
						</code-block>
					</list-item>
				</ordered-list>
			</body>
		</task>

		<task id="create-database">
			<title>Create a database</title>
			<body>
				<ordered-list>
					<list-item>
						<paragraph>Replace the stub for the <code>createTheDatabase</code> method in the
							<code>HCAppDelegate.m</code> file with the following functional
							code:</paragraph>
						<code-block language="objective-c">
// creates the database
- (BOOL) createTheDatabase {
    
    NSError *error;
    
    // create a name for the database and make sure the name is legal
    NSString *dbname = @"my-new-database";
    if (![CBLManager isValidDatabaseName: dbname]) {
        NSLog (@"Bad database name");
        return NO;
    }
    
    // create a new database
    _database = [_manager databaseNamed: dbname error: &amp;error];
    if (!_database) {
        NSLog (@"Cannot create database. Error message: %@", 
            error.localizedDescription);
        return NO;
    }
    
    // log the database location
    NSString *databaseLocation = 
        [[[[NSBundle mainBundle] bundlePath] stringByDeletingLastPathComponent] 
            stringByAppendingString: @"/Library/Application Support/CouchbaseLite"];
    NSLog(@"Database %@ created at %@", dbname, 
        [NSString stringWithFormat:@"%@/%@%@", databaseLocation, dbname, @".cblite"]);
    
    return YES;
}
						
						</code-block>
						<paragraph>The <code>createTheDatabase</code> method sets up and validates a name
							for the database and then creates the database. It is important to validate the
							database name because it must conform to the following rules:</paragraph>
						<unordered-list>
							<list-item>The database name must begin with a lowercase letter.</list-item>
							<list-item>The database name must contain only valid characters. The following characters are valid in database names:
								<unordered-list>
									<list-item>Lowercase letters:<code> a-z</code></list-item>
									<list-item>Numbers: <code>0-9</code></list-item>
									<list-item>Special characters: <code>_$()+-/</code></list-item>
								</unordered-list>
							</list-item>
						</unordered-list>
						<paragraph>The file for the database has a <code>.cblite</code>
							extension. Unless you specify a different path for it, the
							<code>my-new-database.cblite</code> file is located in an iPhone simulator
							application support library such as
							<code>~/Library/Application Support/iPhone Simulator/7.1/Applications/2D92988D-B074-4789-B2DB-9260D2D99B50/Library/Application Support/CouchbaseLite</code>. For convenience, the log message contains the location of the database.</paragraph></list-item>
					<list-item>
						<paragraph>Build and run the app.</paragraph>
					</list-item>
					<list-item>View the console output. <paragraph>The console output displays a message
							similar to the following one that indicates the database was created.</paragraph>
						<code-block>
2014-05-07 14:25:35.333 HelloCBL[29967:60b] Database my-new-database created at /Users/amy/Library/Application Support/iPhone Simulator/7.1/Applications/41B3CCFD-5D38-44A4-A36A-75F9A172F6BE/Library/Application Support/CouchbaseLite/my-new-database.cblite							
						</code-block>
					</list-item>
				</ordered-list>
			</body>
		</task>

	</tasks>
</lesson>
